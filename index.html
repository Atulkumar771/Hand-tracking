<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SRIYUU Love Particles</title>

<style>
    body {
        margin: 0;
        overflow: hidden;
        background: #000;
        font-family: 'Arial', sans-serif;
    }

    /* ------- Intro Screen ------- */
    #intro {
        position: fixed;
        inset: 0;
        background: black;
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        z-index: 20;
        font-size: 30px;
        letter-spacing: 2px;
        animation: fadein 1.5s ease-in-out;
    }

    #startBtn {
        margin-top: 30px;
        padding: 12px 25px;
        font-size: 20px;
        background: #ff2b6e;
        border: none;
        border-radius: 10px;
        color: white;
    }

    @keyframes fadein {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    #gesture {
        position: absolute;
        bottom: 10px;
        left: 10px;
        padding: 8px 12px;
        color: white;
        background: rgba(0,0,0,0.4);
        border-radius: 5px;
        z-index: 10;
    }
</style>
</head>

<body>

<div id="intro">
    <div>✨ MADE FOR SRIYUU ✨</div>
    <button id="startBtn">Tap to Begin ❤️</button>
</div>

<audio id="bgMusic" src="loveyou.mp3" loop></audio>

<canvas id="canvas"></canvas>
<div id="gesture">Loading…</div>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
    "three/examples/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/",
    "@mediapipe/hands": "https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"
  }
}
</script>

<script type="module">
import * as THREE from "three";
import { Hands } from "@mediapipe/hands";

let started = false;

const intro = document.getElementById("intro");
const startBtn = document.getElementById("startBtn");
const bgMusic = document.getElementById("bgMusic");

// Start website
startBtn.onclick = () => {
    intro.style.display = "none";
    bgMusic.play().catch(()=>{});
    started = true;
};

// THREE.js Setup
const canvas = document.getElementById("canvas");
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

const camera = new THREE.PerspectiveCamera(
    75, window.innerWidth/window.innerHeight, 0.1, 1000
);
camera.position.z = 90;

const renderer = new THREE.WebGLRenderer({ canvas });
renderer.setSize(window.innerWidth, window.innerHeight);

// Particle Materials
const matBlue = new THREE.PointsMaterial({ color: 0x33aaff, size: 1.4 });
const matPink = new THREE.PointsMaterial({ color: 0xff5abf, size: 1.4 });
const matHeart = new THREE.PointsMaterial({ color: 0xff0000, size: 1.8 });
const matBG = new THREE.PointsMaterial({ color: 0xffffff, size: 0.8 });

// Convert Text → Particles
function textToParticles(text, material, yOffset) {
    const c = document.createElement("canvas");
    const ctx = c.getContext("2d");
    c.width = 800; c.height = 200;

    ctx.fillStyle = "white";
    ctx.font = "120px Arial Black";
    ctx.fillText(text, 50, 150);

    const img = ctx.getImageData(0, 0, c.width, c.height);
    let pos = [];

    for (let y = 0; y < img.height; y += 4) {
        for (let x = 0; x < img.width; x += 4) {
            if (img.data[(y * img.width + x)*4 + 3] > 128) {
                pos.push(x - 350, -(y - 100) + yOffset, 0);
            }
        }
    }

    const geo = new THREE.BufferGeometry();
    geo.setAttribute("position", new THREE.Float32BufferAttribute(pos, 3));
    return new THREE.Points(geo, material);
}

// Heart Shape (particle)
function heartShape() {
    let pos = [];
    for (let t = 0; t < Math.PI * 2; t += 0.02) {
        let x = 16 * Math.pow(Math.sin(t), 3);
        let y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2*Math.cos(3*t);
        pos.push(x * 3, y * 3 - 40, 0);
    }
    const geo = new THREE.BufferGeometry();
    geo.setAttribute("position", new THREE.Float32BufferAttribute(pos, 3));
    return new THREE.Points(geo, matHeart);
}

// Create Main Objects
const txtLove = textToParticles("I LOVE YOU", matBlue, 40);
const txtSri = textToParticles("SRIYUU", matPink, -10);
const heart = heartShape();

// Floating background particles
let bgPos = [];
for (let i = 0; i < 2000; i++) {
    bgPos.push(
        (Math.random()*400)-200,
        (Math.random()*400)-200,
        (Math.random()*200)-100
    );
}
const bgGeo = new THREE.BufferGeometry();
bgGeo.setAttribute("position", new THREE.Float32BufferAttribute(bgPos, 3));
const bgParticles = new THREE.Points(bgGeo, matBG);

scene.add(bgParticles, txtLove, txtSri, heart);

// Hand Tracking
let handX = 0, handY = 0;

const hands = new Hands({
    locateFile: (file)=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`,
});
hands.setOptions({
    maxNumHands: 1,
    modelComplexity: 1,
    minDetectionConfidence: 0.6,
    minTrackingConfidence: 0.6
});

hands.onResults((results)=>{
    if(results.multiHandLandmarks.length>0){
        let cx = results.multiHandLandmarks[0][9].x;
        let cy = results.multiHandLandmarks[0][9].y;

        handX = (cx - 0.5) * 80;
        handY = -(cy - 0.5) * 80;
    }
});

// Camera Input
const video = document.createElement("video");
video.style.display = "none";
document.body.appendChild(video);

navigator.mediaDevices.getUserMedia({video:true}).then(stream=>{
    video.srcObject = stream;
    video.play();
    const loop = () => {
        hands.send({image: video});
        requestAnimationFrame(loop);
    };
    loop();
});

// ANIMATIONS
txtLove.scale.set(0.01, 0.01, 0.01);
txtSri.scale.set(0.01, 0.01, 0.01);
heart.scale.set(0.01, 0.01, 0.01);

// animate in
setTimeout(()=>{
    txtLove.scale.set(1,1,1);
    txtSri.scale.set(1,1,1);
    heart.scale.set(1,1,1);
}, 1000);

// Render Loop
function animate(){
    requestAnimationFrame(animate);

    if(started){
        txtLove.position.x += (handX - txtLove.position.x)*0.05;
        txtLove.position.y += (handY - txtLove.position.y)*0.05;

        txtSri.position.x += (handX - txtSri.position.x)*0.05;
        txtSri.position.y += (handY - txtSri.position.y)*0.05;

        heart.position.x += (handX - heart.position.x)*0.05;
        heart.position.y += (handY - heart.position.y)*0.05;
    }

    bgParticles.rotation.y += 0.0005;
    bgParticles.rotation.x += 0.0002;

    renderer.render(scene, camera);
}
animate();

</script>
</body>
</html>
